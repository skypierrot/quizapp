# QuizApp ë°±ì—… ë°©ë²• ë¹„êµ ë° ì¦ë¶„ ë°±ì—… ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” QuizApp í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë°±ì—… ë°©ë²•ì„ ë¹„êµí•˜ê³ , ì¦ë¶„ ë°±ì—…ì˜ êµ¬í˜„ ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ”„ ë°±ì—… ë°©ë²• ë¹„êµ

### ğŸ“Š ë°±ì—… ë°©ë²•ë³„ ìƒì„¸ ë¹„êµ

| ë°©ë²• | ë°±ì—… ìœ í˜• | ë°±ì—… í¬ê¸° | ë°±ì—… ì‹œê°„ | ë³µì› ì‹œê°„ | ë°ì´í„° ë³´ì¡´ | ìš©ë„ |
|------|-----------|-----------|-----------|-----------|-------------|------|
| **Docker ë³¼ë¥¨** | ì „ì²´ ë°±ì—… | 400MB | 2-3ë¶„ | 1-2ë¶„ | ì™„ë²½ | ì „ì²´ ì‹œìŠ¤í…œ ë°±ì—… |
| **SQL ë¤í”„** | ì „ì²´ ë°±ì—… | 450MB+ | 5-10ë¶„ | 10-20ë¶„ | ì™„ë²½ | ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… |
| **ë§ˆì´ê·¸ë ˆì´ì…˜** | êµ¬ì¡° ë°±ì—… | 50MB | 1ë¶„ | 1ë¶„ | êµ¬ì¡°ë§Œ | ê°œë°œ í™˜ê²½ ë°±ì—… |
| **ì¦ë¶„ ë°±ì—…** | ì¦ë¶„ + ì „ì²´ | 50MB + 450MB | 1ë¶„ + 5ë¶„ | 5-10ë¶„ | ì™„ë²½ | ì •ê¸° ë°±ì—… |

### ğŸ¯ ê° ë°©ë²•ì˜ íŠ¹ì§•

#### **1. Docker ë³¼ë¥¨ ë°±ì—… (ì „ì²´)**
```bash
./scripts/backup-restore-volume.sh backup
```

**ì¥ì :**
- âœ… ê°€ì¥ ë¹ ë¥¸ ë³µì› (1-2ë¶„)
- âœ… PostgreSQL ë°ì´í„° íŒŒì¼ ì§ì ‘ ë°±ì—…
- âœ… ì»¨í…Œì´ë„ˆ ì¬ë¹Œë“œ í›„ì—ë„ ì™„ë²½ ë³µêµ¬
- âœ… 400MBë¡œ ì „ì²´ ë°ì´í„° ë³´ì¡´

**ë‹¨ì :**
- âŒ ë§¤ë²ˆ ì „ì²´ ë°±ì—… (í¬ê¸° ë³€í™” ì—†ìŒ)
- âŒ ë°±ì—… ì‹œê°„ì´ ì¼ì • (2-3ë¶„)
- âŒ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì— ì˜ì¡´ì 

**ìš©ë„:** ì „ì²´ ì‹œìŠ¤í…œ ë°±ì—…, í”„ë¡œë•ì…˜ ë°°í¬ ì „ ë°±ì—…

#### **2. SQL ë¤í”„ ë°±ì—… (ì „ì²´)**
```bash
./scripts/quick-backup-predata.sh
```

**ì¥ì :**
- âœ… í‘œì¤€ PostgreSQL ë°©ì‹
- âœ… ë‹¤ë¥¸ PostgreSQL ì„œë²„ë¡œ ì´ì „ ê°€ëŠ¥
- âœ… ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ì™€ ë°ì´í„° ëª¨ë‘ ë³´ì¡´
- âœ… í˜¸í™˜ì„± ìš°ìˆ˜

**ë‹¨ì :**
- âŒ ë§¤ë²ˆ ì „ì²´ ë°±ì—… (í¬ê¸° ë³€í™” ì—†ìŒ)
- âŒ ë³µì› ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼ (10-20ë¶„)
- âŒ ë°±ì—… ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼ (5-10ë¶„)

**ìš©ë„:** ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜, ë‹¤ë¥¸ ì„œë²„ë¡œ ì´ì „

#### **3. ë§ˆì´ê·¸ë ˆì´ì…˜ ë°±ì—… (êµ¬ì¡°)**
```bash
./scripts/backup-predata-migration.sh "backup_name"
```

**ì¥ì :**
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ê³¼ ìŠ¤í‚¤ë§ˆ ë³´ì¡´
- âœ… ë¹ ë¥¸ ë°±ì—… (1ë¶„ ì´ë‚´)
- âœ… ì‘ì€ ë°±ì—… í¬ê¸° (50MB)
- âœ… ë²„ì „ ê´€ë¦¬ì™€ ì—°ë™

**ë‹¨ì :**
- âŒ ì‹¤ì œ ë°ì´í„°ëŠ” ë°±ì—…í•˜ì§€ ì•ŠìŒ
- âŒ ë°ì´í„° ë³µì› ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¬ì‹¤í–‰ í•„ìš”
- âŒ ì™„ì „í•œ ë³µêµ¬ê°€ ì–´ë ¤ì›€

**ìš©ë„:** ê°œë°œ í™˜ê²½ ë°±ì—…, ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê´€ë¦¬

#### **4. ì¦ë¶„ ë°±ì—… (í˜¼í•©)**
```bash
./scripts/incremental-backup.sh backup "backup_name"
```

**ì¥ì :**
- âœ… ë² ì´ìŠ¤ ë°±ì—… + ë³€ê²½ì‚¬í•­ë§Œ ë°±ì—…
- âœ… ì •ê¸° ë°±ì—… ì‹œ ì‹œê°„ê³¼ ê³µê°„ ì ˆì•½
- âœ… WAL ì•„ì¹´ì´ë¸Œë¡œ íŠ¸ëœì­ì…˜ ë¡œê·¸ ë³´ì¡´
- âœ… Point-in-time ë³µêµ¬ ê°€ëŠ¥

**ë‹¨ì :**
- âŒ ë³µì¡í•œ ë³µì› ê³¼ì •
- âŒ ë² ì´ìŠ¤ ë°±ì—…ê³¼ ì¦ë¶„ ë°±ì—… ëª¨ë‘ í•„ìš”
- âŒ ì„¤ì •ì´ ë³µì¡í•¨

**ìš©ë„:** ì •ê¸° ë°±ì—…, ëŒ€ìš©ëŸ‰ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

## ğŸš€ ì¦ë¶„ ë°±ì—… êµ¬í˜„

### ğŸ“ ì¦ë¶„ ë°±ì—… êµ¬ì¡°

```
backups/incremental/
â”œâ”€â”€ base/                           # ë² ì´ìŠ¤ ë°±ì—… (ì „ì²´)
â”‚   â”œâ”€â”€ base_backup.sql            # ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ë¤í”„
â”‚   â””â”€â”€ base_backup_info.txt       # ë² ì´ìŠ¤ ë°±ì—… ì •ë³´
â”œâ”€â”€ incremental/                    # ì¦ë¶„ ë°±ì—… (ë³€ê²½ì‚¬í•­)
â”‚   â”œâ”€â”€ incremental_20250813_233630.csv
â”‚   â”œâ”€â”€ incremental_20250813_233630_info.txt
â”‚   â””â”€â”€ ...
â””â”€â”€ wal_archive/                    # WAL ì•„ì¹´ì´ë¸Œ (íŠ¸ëœì­ì…˜ ë¡œê·¸)
    â”œâ”€â”€ 000000010000000000000001
    â”œâ”€â”€ 000000010000000000000002
    â””â”€â”€ ...
```

### ğŸ”§ ì¦ë¶„ ë°±ì—… ì‘ë™ ì›ë¦¬

#### **1. ë² ì´ìŠ¤ ë°±ì—… (Base Backup)**
- **ì‹œì **: ì¦ë¶„ ë°±ì—… ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ìƒì„±
- **ë‚´ìš©**: ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì™„ì „í•œ ìŠ¤ëƒ…ìƒ·
- **í¬ê¸°**: 450MB+ (ì „ì²´ ë°ì´í„°)
- **ìš©ë„**: ì¦ë¶„ ë°±ì—…ì˜ ê¸°ì¤€ì 

#### **2. ì¦ë¶„ ë°±ì—… (Incremental Backup)**
- **ì‹œì **: ì •ê¸°ì ìœ¼ë¡œ (ë§¤ì¼, ë§¤ì£¼ ë“±)
- **ë‚´ìš©**: ë§ˆì§€ë§‰ ë°±ì—… ì´í›„ ë³€ê²½ëœ ë°ì´í„°ë§Œ
- **í¬ê¸°**: 1-10MB (ë³€ê²½ì‚¬í•­ì— ë”°ë¼)
- **ìš©ë„**: ë² ì´ìŠ¤ ë°±ì—… ì´í›„ì˜ ë³€ê²½ì‚¬í•­ ë³´ì¡´

#### **3. WAL ì•„ì¹´ì´ë¸Œ (Write-Ahead Log)**
- **ì‹œì **: ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒì„±
- **ë‚´ìš©**: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ì‚¬í•­ì˜ ë¡œê·¸
- **í¬ê¸°**: ë§¤ìš° ì‘ìŒ (KB ë‹¨ìœ„)
- **ìš©ë„**: Point-in-time ë³µêµ¬, íŠ¸ëœì­ì…˜ ë¬´ê²°ì„±

### ğŸ“Š ì¦ë¶„ ë°±ì—… vs ì „ì²´ ë°±ì—… í¬ê¸° ë¹„êµ

#### **ì „ì²´ ë°±ì—… (ë§¤ì¼)**
```
Day 1: 450MB
Day 2: 450MB
Day 3: 450MB
Day 4: 450MB
Day 5: 450MB
Total: 2.25GB (5ì¼)
```

#### **ì¦ë¶„ ë°±ì—… (ë² ì´ìŠ¤ + ì¦ë¶„)**
```
Day 1: 450MB (ë² ì´ìŠ¤)
Day 2: 5MB (ì¦ë¶„)
Day 3: 3MB (ì¦ë¶„)
Day 4: 7MB (ì¦ë¶„)
Day 5: 4MB (ì¦ë¶„)
Total: 469MB (5ì¼)
```

**ì ˆì•½ íš¨ê³¼:** 5ì¼ ê¸°ì¤€ **80% ê³µê°„ ì ˆì•½** (2.25GB â†’ 469MB)

## ğŸ”„ ì¦ë¶„ ë°±ì—… ì‚¬ìš©ë²•

### 1. ì´ˆê¸° ì„¤ì • (ë² ì´ìŠ¤ ë°±ì—…)

```bash
# ì²« ë²ˆì§¸ ì¦ë¶„ ë°±ì—… (ë² ì´ìŠ¤ ë°±ì—… ìƒì„±)
./scripts/incremental-backup.sh backup "initial_backup"
```

**ê²°ê³¼:**
```
ğŸš€ PostgreSQL ì¦ë¶„ ë°±ì—… ì‹œì‘...
ğŸ“¦ ë°±ì—… ì´ë¦„: initial_backup
ğŸ“Š ë² ì´ìŠ¤ ë°±ì—… ìƒì„± ì¤‘...
âœ… ë² ì´ìŠ¤ ë°±ì—… ì™„ë£Œ: backups/incremental/base/base_backup.sql
ğŸ“Š ì¦ë¶„ ë°±ì—… ìƒì„± ì¤‘...
âœ… ì¦ë¶„ ë°±ì—… ì™„ë£Œ: backups/incremental/incremental_20250813_233630_info.txt

ğŸ“Š ë°±ì—… í¬ê¸° ìš”ì•½:
   ë² ì´ìŠ¤ ë°±ì—…: 450M
   ì¦ë¶„ ë°±ì—…: 5M
   WAL ì•„ì¹´ì´ë¸Œ: 2M
   ì „ì²´ ë°±ì—…: 457M
```

### 2. ì •ê¸° ì¦ë¶„ ë°±ì—…

```bash
# ë‘ ë²ˆì§¸ë¶€í„°ëŠ” ì¦ë¶„ ë°±ì—…ë§Œ ìƒì„±
./scripts/incremental-backup.sh backup "daily_backup_$(date +%Y%m%d)"
```

**ê²°ê³¼:**
```
ğŸš€ PostgreSQL ì¦ë¶„ ë°±ì—… ì‹œì‘...
ğŸ“¦ ë°±ì—… ì´ë¦„: daily_backup_20250813
â­ï¸  ë² ì´ìŠ¤ ë°±ì—…ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.
ğŸ“Š ì¦ë¶„ ë°±ì—… ìƒì„± ì¤‘...
âœ… ì¦ë¶„ ë°±ì—… ì™„ë£Œ: backups/incremental/incremental_20250813_233630_info.txt

ğŸ“Š ë°±ì—… í¬ê¸° ìš”ì•½:
   ë² ì´ìŠ¤ ë°±ì—…: 450M
   ì¦ë¶„ ë°±ì—…: 8M
   WAL ì•„ì¹´ì´ë¸Œ: 5M
   ì „ì²´ ë°±ì—…: 463M
```

### 3. ì¦ë¶„ ë°±ì—… ë³µì›

```bash
# ë² ì´ìŠ¤ ë°±ì—… + ì¦ë¶„ ë°±ì—… ë³µì›
./scripts/incremental-backup.sh restore "daily_backup_20250813"
```

**ê²°ê³¼:**
```
ğŸ”„ PostgreSQL ì¦ë¶„ ë°±ì—… ë³µì› ì‹œì‘...
ğŸ“¦ ë°±ì—… ì´ë¦„: daily_backup_20250813
ğŸ“Š ë² ì´ìŠ¤ ë°±ì—… ë³µì› ì¤‘...
ğŸ“Š ì¦ë¶„ ë°±ì—… ë³µì› ì¤‘...
ğŸ“‹ ìµœì‹  ì¦ë¶„ ë°±ì—… ë³µì›: incremental_20250813_233630_info.txt
ğŸ“Š ì¦ë¶„ ë°ì´í„° ë³µì› ì¤‘...
âœ… ì¦ë¶„ ë°±ì—… ë³µì› ì™„ë£Œ!

ğŸ“Š ë³µì› í™•ì¸ ì¤‘...
 table_name | count  
------------+--------
 questions  | 1183619
 exams      |  24387
 images     | 220387
```

## ğŸ“ˆ ë°±ì—… ì „ëµ ë° ê¶Œì¥ì‚¬í•­

### ğŸ¯ ìƒí™©ë³„ ë°±ì—… ë°©ë²• ì„ íƒ

#### **ê°œë°œ í™˜ê²½**
```bash
# 1. ì´ˆê¸° ì„¤ì • ì‹œ
./scripts/incremental-backup.sh backup "dev_initial"

# 2. ì •ê¸° ë°±ì—… (ë§¤ì¼)
./scripts/incremental-backup.sh backup "dev_daily_$(date +%Y%m%d)"

# 3. ì½”ë“œ ë³€ê²½ ì „ ì•ˆì „ì¥ì¹˜
./scripts/backup-restore-volume.sh backup
```

#### **í”„ë¡œë•ì…˜ í™˜ê²½**
```bash
# 1. ë°°í¬ ì „ ì „ì²´ ë°±ì—…
./scripts/backup-restore-volume.sh backup

# 2. ì •ê¸° ë°±ì—… (ë§¤ì£¼)
./scripts/incremental-backup.sh backup "prod_weekly_$(date +%Y%m%d)"

# 3. ì›”ê°„ ì „ì²´ ë°±ì—…
./scripts/backup-restore-volume.sh backup
```

#### **í…ŒìŠ¤íŠ¸ í™˜ê²½**
```bash
# 1. í…ŒìŠ¤íŠ¸ ì „ ë°±ì—…
./scripts/quick-backup-predata.sh

# 2. í…ŒìŠ¤íŠ¸ í›„ ë³µì›
./scripts/restore-predata-migration.sh backups/predata_quick/backup_name
```

### ğŸ“… ë°±ì—… ìŠ¤ì¼€ì¤„ ê¶Œì¥ì‚¬í•­

#### **Cron ì‘ì—… ì„¤ì •**
```bash
# crontab í¸ì§‘
crontab -e

# ë§¤ì¼ ìƒˆë²½ 2ì‹œì— ì¦ë¶„ ë°±ì—…
0 2 * * * cd /home/guri/develop/quizapp && ./scripts/incremental-backup.sh backup "daily_$(date +%Y%m%d)"

# ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 3ì‹œì— ì „ì²´ ë°±ì—…
0 3 * * 0 cd /home/guri/develop/quizapp && ./scripts/backup-restore-volume.sh backup

# ë§¤ì›” ì²«ì§¸ ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 4ì‹œì— ë² ì´ìŠ¤ ë°±ì—… ê°±ì‹ 
0 4 1-7 * 0 cd /home/guri/develop/quizapp && ./scripts/incremental-backup.sh backup "monthly_base_$(date +%Y%m)"
```

## ğŸ› ï¸ ë¬¸ì œ í•´ê²° ë° ìµœì í™”

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### **1. WAL ì„¤ì • ì‹¤íŒ¨**
```bash
# PostgreSQL ì„¤ì • íŒŒì¼ ì§ì ‘ ìˆ˜ì •
sudo docker exec -it quizapp-db-dev bash
echo "wal_level = replica" >> /var/lib/postgresql/data/postgresql.conf
echo "archive_mode = on" >> /var/lib/postgresql/data/postgresql.conf
echo "archive_command = 'cp %p /backup/wal_archive/%f'" >> /var/lib/postgresql/data/postgresql.conf
exit
docker-compose -f docker-compose.dev.yml restart quizapp-db
```

#### **2. ì¦ë¶„ ë°±ì—… í¬ê¸° ìµœì í™”**
```bash
# ë³€ê²½ëœ ë°ì´í„°ë§Œ ì •í™•íˆ ì¶”ì¶œ
sudo docker exec quizapp-db-dev psql -U postgres -d quizapp -c "
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size,
    last_vacuum,
    last_autovacuum
FROM pg_stat_user_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
"
```

#### **3. ë°±ì—… ì••ì¶• ìµœì í™”**
```bash
# ë” ë†’ì€ ì••ì¶•ë¥  (ì‹œê°„ì€ ë” ì˜¤ë˜ ê±¸ë¦¼)
sudo docker run --rm \
    -v quizapp_db_data_dev:/data \
    -v $(pwd)/backups:/backup \
    alpine tar cJf "/backup/quizapp_db_$(date +%Y%m%d_%H%M%S).tar.xz" -C /data .
```

## ğŸ¯ ê²°ë¡ 

### ğŸ“Š ë°±ì—… ë°©ë²• ì„ íƒ ê°€ì´ë“œ

#### **ì „ì²´ ë°±ì—…ì´ ì í•©í•œ ê²½ìš°:**
- âœ… **ì´ˆê¸° ì„¤ì • ì‹œ**: ì‹œìŠ¤í…œ êµ¬ì¶• í›„ ì²« ë°±ì—…
- âœ… **ì£¼ìš” ë³€ê²½ ì „**: ì½”ë“œ ë°°í¬, ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì „
- âœ… **ì›”ê°„ ë°±ì—…**: ì •ê¸°ì ì¸ ì „ì²´ ì‹œìŠ¤í…œ ë°±ì—…
- âœ… **í”„ë¡œë•ì…˜ ë°°í¬**: ì•ˆì „í•œ ë°°í¬ë¥¼ ìœ„í•œ ë°±ì—…

#### **ì¦ë¶„ ë°±ì—…ì´ ì í•©í•œ ê²½ìš°:**
- âœ… **ì¼ì¼ ë°±ì—…**: ì •ê¸°ì ì¸ ë°ì´í„° ë³´í˜¸
- âœ… **ê°œë°œ í™˜ê²½**: ìì£¼ ë³€ê²½ë˜ëŠ” ê°œë°œ ë°ì´í„°
- âœ… **ì €ì¥ ê³µê°„ ì ˆì•½**: ë°±ì—… í¬ê¸° ìµœì í™” í•„ìš”
- âœ… **ë¹ ë¥¸ ë°±ì—…**: ë°±ì—… ì‹œê°„ ë‹¨ì¶• í•„ìš”

### ğŸš€ ê¶Œì¥ ë°±ì—… ì „ëµ

```bash
# 1. ì´ˆê¸° ì„¤ì • (ë² ì´ìŠ¤ ë°±ì—…)
./scripts/incremental-backup.sh backup "initial_setup"

# 2. ì •ê¸° ì¦ë¶„ ë°±ì—… (ë§¤ì¼)
./scripts/incremental-backup.sh backup "daily_$(date +%Y%m%d)"

# 3. ì•ˆì „ì¥ì¹˜ ë°±ì—… (ì£¼ìš” ë³€ê²½ ì „)
./scripts/backup-restore-volume.sh backup

# 4. ì›”ê°„ ì „ì²´ ë°±ì—… (ë² ì´ìŠ¤ ê°±ì‹ )
./scripts/incremental-backup.sh backup "monthly_base_$(date +%Y%m)"
```

ì´ ì „ëµì„ í†µí•´ **ì‹œê°„ê³¼ ê³µê°„ì„ ì ˆì•½í•˜ë©´ì„œë„ ì•ˆì „í•œ ë°ì´í„° ë³´í˜¸**ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ‰

